<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script src="../coi-serviceworker.js"></script>

    <link rel="icon" href="https://hypotheek-bereken.com/favicon.ico">
    <link rel="apple-touch-icon" href="https://hypotheek-bereken.com/icon.png">
    <link rel="manifest" href="https://hypotheek-bereken.com/manifest.json">
    <link rel="canonical" href="https://hypotheek-bereken.com/">
    <link rel="preload" as="image" href="https://github.blog/wp-content/uploads/2008/12/forkme_right_green_007200.png?resize=149%2C149">

    <script src="../loans.js"></script>
    <script src="../main.js"></script>
    <script src="../deploy_info.js"></script>
    <script src="../chat.js"></script>

    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="Mortgage analysis tool: calculate monthly payments schedule with extra repayments (linear, annuity, interest only). Mortgage vs renting profitability analysis. What-if mortgage modelling. AI mortgage analysis assistant.">
    <meta name="keywords" content="Mortgage calculator netherlands, dutch mortgage calculator, compare mortgages, annuity mortgage, linear mortgage, interest only mortgage, mortgage planning tool, mortgage repayment, monthly mortgage breakdown">

    <meta name="kw-mode-basic" content="Basic mortgage calculation parameters.">
    <meta name="kw-mode-advanced" content="Advanced mortgage calculation parameters.">
    <meta name="kw-mode-llm" content="LLM-based AI mortgage assistant.">
    <meta name="kw-mode-help" content="Details about the mortgage calculation tool. Links to additional documentation.">

    <meta name="kw-page-mortgage" content="Loan parameters.">
    <meta name="kw-page-costs" content="Mortgage opening costs.">
    <meta name="kw-page-repayments" content="Additional extra repayment settings.">
    <meta name="kw-page-assets" content="End of term modelled financial outcomes for mortgage vs renting scenarios.">
    <meta name="kw-page-whatif" content="What-if analysis tool to run and compare several hypothetical loan scenarios.">
    <meta name="kw-page-entry" content="Mortgage entrypoint analysis tool to compare financial outcomes of loans opened with different delays.">

    <title>Mortgage payments calculator (for Netherlands)</title>

    <link href="../main.css" rel="stylesheet">

    <script id="plotlyjs" src='https://cdn.plot.ly/plotly-2.35.2.min.js' async crossorigin></script>
</head>

<body>
    <div class="container">

        <section class="section title">
            <div class="header">
                <h1 data-id="h_1">Mortgage analysis tool</h1>
                <br>
                <h2 data-id="h_2">Mortgage calculator and analysis tool (Netherlands) for anuity, linear, interest-only loans</h2>
                <h2 data-id="h_5">Amortization schedule, repayments,  loan profitability vs renting and investing</h2>
                <a data-id="language" href="/nl/rekenmachine.html">üá≥üá± toets hier voor Nederlands</a>
            </div>
        </section>

        <button id="btn_copy" title="Share this calculation">Share</button>

        <div class="tabs is-primary">
            <ul>
                <li class="tab_selector tab_big is-active" data-block="basic"><a role=button data-id="b_simple">üî® Basic parameters</a></li>
                <li class="tab_selector tab_big" data-block="advanced"><a role=button data-id="b_advanced">‚öôÔ∏è Advanced parameters</a></li>
                <li class="tab_selector tab_big" data-block="llm"><a role=button data-id="b_llm">ü§ñ AI assistant</a></li>
                <li class="tab_selector tab_big" data-block="help"><a role=button data-id="b_help">‚ùì Help / Instructions</a></li>
            </ul>
        </div>

        <div data-block="basic" class="block is-visible">
            <section class="section"><h2 data-id="h_3">Mortgage parameters (basic):</h2>
                <div class="columns">

                    <div class="column">
                        <div class="field" data-default="400000" data-tune="10000">
                            <label for="house_price">House price</label>
                            <div class="control"><input id="house_price" class="input" type="text" value="">
                            <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="house_price_tip" data-tooltip="Price of the property under consideration">?</span></div>
                        </div>
                        <div class="field" data-default="100000" data-tune="10000">
                            <label for="downpayment">Savings used for downpayment</label>
                            <div class="control"><input id="downpayment" class="input" type="text" value="">
                            <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="downpayment_tip" data-tooltip="Amount to be spent on buying the house (loan downpayment and transactional purchase expenses).">?</span></div>
                        </div>
                    </div>

                    <div class="column">
                        <div class="field" data-default="0" data-tune="50">
                            <label for="extra_payment_monthly">Extra repayment, monthly</label>
                            <div class="control"><input id="extra_payment_monthly" class="input" type="text" value="">
                            <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="extra_payment_monthly_tip" data-tooltip="Fixed monthly additional mortgage extra repayment.">?</span></div>
                        </div>
                        <div class="field" data-default="0" data-tune="50">
                            <label for="extra_payment_topup">Minimal monthly payment</label>
                            <div class="control"><input id="extra_payment_topup" class="input" type="text" value="">
                            <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="extra_payment_topup_tip" data-tooltip="If standard calculated monthly payment is less than this number - difference will be added as an extra repayment. Useful for 'linear' mortgages if you want to have keep more or less constant payments throuhgout.">?</span></div>
                        </div>
                    </div>

                    <div class="column">
                        <div class="field" data-default="1500" data-tune="100">
                            <label for="monthly_payment_rent">Monthly rent payment</label>
                            <div class="control"><input id="monthly_payment_rent" class="input" type="text" value="">
                            <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="monthly_payment_rent_tip" data-tooltip="monthly rent payment under 'rent' scenario.">?</span></div>
                        </div>
                        <div class="field" data-default="100000" data-tune="1000">
                            <label for="total_cash_savings">Available cash savings</label>
                            <div class="control"><input id="total_cash_savings" class="input" type="text" value="">
                            <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="total_cash_savings_tip" data-tooltip="Cash savings available at the moment of opening the mortgage.">?</span></div>
                        </div>
                        <div class="field" data-default="500" data-tune="500">
                            <label for="monthly_savings">Monthly savings</label>
                            <div class="control"><input id="monthly_savings" class="input" type="text" value="">
                            <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="monthly_savings_tip" data-tooltip="monthly savings under 'rent' scenario (salary - expenses - rent).">?</span></div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <div data-block="advanced" class="block">
            <section class="section"><h2 data-id="h_13">Mortgage parameters (advanced):</h2>
                <div class="tabs is-primary">
                    <ul>
                        <li class="tab_selector is-active" data-block="mortgage"><a role=button data-id="b_mortgage">üè† Mortgage</a></li>
                        <li class="tab_selector" data-block="costs"><a role=button data-id="b_costs">üíµ Purchase Costs</a></li>
                        <li class="tab_selector" data-block="repayments"><a role=button data-id="b_repayments">üí≤ Extra repayments</a></li>
                        <li class="tab_selector" data-block="assets"><a role=button data-id="b_assets">üí∞ Profitability</a></li>
                        <li class="tab_selector" data-block="whatif"><a role=button data-id="b_whatif">‚ú® What-if</a></li>
                        <li class="tab_selector" data-block="entry"><a role=button data-id="b_entry">‚ú® Entrypoint</a></li>
                        <!-- <li class="" data-block="split"><a role=button data-id="b_split">‚ú® Split</a></li> -->
                    </ul>
                </div>

                <div data-block="mortgage" class="block is-visible">
                    <div class="columns">

                        <div class="column">
                            <div class="field" data-default="115" data-tune="1">
                                <label for="value_discount">House price / House value</label>
                                <div class="control"><input id="value_discount" class="input" type="text" value="">
                                <span class="icon"><i>%</i></span><span class="tooltip" data-for="value_discount_tip" data-tooltip="Coefficient determining real house value (relative to asked price).">?</span></div>
                            </div>
                            <div class="field" data-formula="Math.round(100 * house_price / value_discount)">
                                <label for="house_value">House value</label>
                                <div class="control"><input id="house_value" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="house_value_tip" data-tooltip="Property value (WOZ)">?</span></div>
                            </div>

                            <div class="field" data-round="0" data-formula="total_purchase_cost">
                                <label for="cost">Purchase cost</label>
                                <div class="control"><input id="cost" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="cost_tip" data-tooltip="One-off costs of aquiring the property (transfer taxe, fees etc..)">?</span></div>
                            </div>

                            <div class="field" data-round="0" data-formula="downpayment - cost">
                                <label for="actual_downpayment">Loan downpayment</label>
                                <div class="control"><input id="actual_downpayment" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="actual_downpayment_tip" data-tooltip="Actual downpayment amount to be used for the loan (total downpayment decreased by purchase transactional costs)">?</span></div>
                            </div>

                            <div class="field" data-round="0" data-formula="Math.max(0, house_price - actual_downpayment)">
                                <label for="loan">Required loan amount</label>
                                <div class="control"><input id="loan" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="loan_tip" data-tooltip="Loan amount AKA principal debt: amount you need to lend from a bank">?</span></div>
                            </div>
                            <div class="field" data-formula="Math.round(10000 * loan / house_value) / 100">
                                <label for="loan_to_value">Loan to Value (LTV)</label>
                                <div class="control"><input id="loan_to_value" class="input" type="text" value="">
                                <span class="icon"><i>%</i></span><span class="tooltip" data-for="loan_to_value_tip" data-tooltip="Value of the mortgage loan in relation to the value of the home. Smaller it is - lower will be the mortgage interest rate available.">?</span></div>
                            </div>
                            <div class="field" data-type="raw" data-formula="loan > 0 ? ((cost_nhg > 0)? 'NHG' : (Math.ceil(loan_to_value/5)*5)):'no loan needed'">
                                <label for="loan_bracket">Loan risk bracket</label>
                                <div class="control"><input id="loan_bracket" class="input" type="text" value="">
                                <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="loan_bracket_tip" data-tooltip="Risk bracket class defines lowest mortgage interest rate accessible from the banks.">?</span></div>
                            </div>
                            
                        </div>

                        <div class="column">
                            <div class="field" data-default="30*12" data-tune="12">
                                <label for="loan_term">Loan term (months)</label>
                                <div class="control"><input id="loan_term" class="input" type="text" value="">
                                <span class="icon"><i>m</i></span><span class="tooltip" data-for="loan_term_tip" data-tooltip="Loan maturity AKA 'loan term' AKA 'loan lifetime'.">?</span></div>
                            </div>
                            <div class="field" data-formula="loan_stats_result.actual_term">
                                <label for="loan_term_actual">Loan term actual (months)</label>
                                <div class="control"><input id="loan_term_actual" class="input" type="text" value="">
                                <span class="icon"><i>m</i></span><span class="tooltip" data-for="loan_term_actual_tip" data-tooltip="Actual loan lifetime. Might be smaller than actual loan term if extra repayments being made.">?</span></div>
                            </div>
                            <div class="field" data-formula="loan_term - loan_term_actual">
                                <label for="loan_term_reduction">Loan term reduction (months)</label>
                                <div class="control"><input id="loan_term_reduction" class="input" type="text" value="">
                                <span class="icon"><i>m</i></span><span class="tooltip" data-for="loan_term_reduction_tip" data-tooltip="Decrease in the loan term caused by extra repayments made.">?</span></div>
                            </div>
                            <div class="field" data-round="3" data-default="3.8" data-tune="0.01">
                                <label for="interest_rate">Loan Interest</label>
                                <div class="control"><input id="interest_rate" class="input" type="text" value="3.8">
                                <span class="icon"><i>%</i></span><span class="tooltip" data-for="interest_rate_tip" data-tooltip="Annual loan (mortgage) insterest rate.">?</span></div>
                            </div>
                            <div class="field" data-default="1" data-tune="1">
                                <label for="loan_type">Loan type: 1 - Annuity, 2 - Linear, 3 - Interest only</label>
                                <div class="control"><input id="loan_type" class="input" type="text" value="">
                                <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="loan_type_tip" data-tooltip="Defines the loan type. Interest-only mortgages are not tax (box-1) deductible.">?</span></div>
                            </div>

                        </div>

                        <div class="column">
                            <div class="field" data-default="36.93" data-tune="0.01">
                                <label for="tax_rate">Loan interest tax deductible (hypotheekrenteaftrek):</label>
                                <div class="control"><input id="tax_rate" class="input" type="text" value="36.93">
                                <span class="icon"><i>%</i></span><span class="tooltip" data-for="tax_rate_tip" data-tooltip="Tax (box-1) deductible percentage of interest amount repaid.">?</span></div>
                            </div>
                            <div class="field" data-default="1" data-tune="1">
                                <label for="tax_scheme">Tax refund target: 0 - none, 1 - benefit, 2 - principal</label>
                                <div class="control"><input id="tax_scheme" class="input" type="text" value="">
                                <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="tax_scheme_tip" data-tooltip="what happens with tax refunds: 0 - turned off, 1 - accrued as an income, 2 - used (monthly) for extra repayments.">?</span></div>
                            </div>
                            <div class="field" data-formula="loan_stats_result.total_tax_returned">
                                <label for="total_tax_returned">Total tax returned (hypotheekrenteaftrek):</label>
                                <div class="control"><input id="total_tax_returned" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="total_tax_returned_tip" data-tooltip="Total amount of tax refunded (it will be 0 if loan is not refundable or refunds turned off or refunds used for repayments).">?</span></div>
                            </div>

                            <div class="field" data-formula="Math.round(10000 * monthly_avg_loan_invested / (monthly_savings + monthly_payment_rent + ((bonus_cash + bonus_stocks)/12))) / 100">
                                <label for="debt_to_income">Debt to income (DTI)</label>
                                <div class="control"><input id="debt_to_income" class="input" type="text" value="">
                                <span class="icon"><i>%</i></span><span class="tooltip" data-for="debt_to_income_tip" data-tooltip="Percentage of your monthly estimated gross income that is used to pay your monthly debt. It determines your borrowing risk.">?</span></div>
                            </div>
                            <div class="field" data-formula="(1/100) * ((loan > 0)?(Math.round(10000 * total_paid_interest / loan)):0)">
                                <label for="total_interest_percentage">Total interest percentage (TIP)</label>
                                <div class="control"><input id="total_interest_percentage" class="input" type="text" value="">
                                <span class="icon"><i>%</i></span><span class="tooltip" data-for="total_interest_percentage_tip" data-tooltip="percentage of the total amount of interest paid from the actual amount borrowed">?</span></div>
                            </div>
                            <div class="field" data-formula="(1/100) * (loan>0?(Math.round(10000 * (total_paid_interest - total_tax_returned + total_purchase_cost - purchase_deductible_cost * (tax_rate / 100)) * 12 / (loan * loan_term_actual))):0)">
                                <label for="annual_percentage_rate">Annual Percentage Rate (APR)</label>
                                <div class="control"><input id="annual_percentage_rate" class="input" type="text" value="">
                                <span class="icon"><i>%</i></span><span class="tooltip" data-for="annual_percentage_rate_tip" data-tooltip="Total annual cost of borrowing money, represented as a percentage.">?</span></div>
                            </div>


                        </div>

                        <div class="column">
                            <div class="field" data-formula="total_paid_net + downpayment">
                                <label for="total_loan_invested">Total loan invested</label>
                                <div class="control"><input id="total_loan_invested" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="total_loan_invested_tip" data-tooltip="Total amount used during the mortgage (downpayment + all monthly payments)">?</span></div>
                            </div>

                            <div class="field" data-formula="loan_stats_result.total_paid_extra">
                                <label for="total_paid_extra">Total repaid extra</label>
                                <div class="control"><input id="total_paid_extra" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="total_paid_extra_tip" data-tooltip="Total amount of extra repayments made (if any).">?</span></div>
                            </div>

                            <div class="field" data-formula="Math.max(0, loan_stats_result.total_paid_gross)">
                                <label for="total_paid_gross">Total repaid (gross)</label>
                                <div class="control"><input id="total_paid_gross" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="total_paid_gross_tip" data-tooltip="Total payments made towards the mortgage.">?</span></div>
                            </div>
                            <div class="field" data-formula="Math.max(0, loan_stats_result.total_paid_net)">
                                <label for="total_paid_net">Total repaid (net)</label>
                                <div class="control"><input id="total_paid_net" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="total_paid_net_tip" data-tooltip="Total payments made towards the mortgage minus all tax refunds.">?</span></div>
                            </div>
                            <div class="field" data-formula="loan_stats_result.total_paid_penalty">
                                <label for="total_paid_penalty">Total paid penalties</label>
                                <div class="control"><input id="total_paid_penalty" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="total_paid_penalty_tip" data-tooltip="Total amount of penalties paid for over-repayments (repaying more than allowed by the bank), if any.">?</span></div>
                            </div>

                            <div class="field" data-formula="total_paid_gross - loan - total_paid_penalty">
                                <label for="total_paid_interest">Total interest paid</label>
                                <div class="control"><input id="total_paid_interest" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="total_paid_interest_tip" data-tooltip="Total amount of interest paid during the loan.">?</span></div>
                            </div>

                            <div class="field" data-formula="total_paid_net / loan_term_actual">
                                <label for="monthly_avg_loan_invested">Average montlhy loan investment</label>
                                <div class="control"><input id="monthly_avg_loan_invested" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="monthly_avg_loan_invested_tip" data-tooltip="total loan investment over the actual loan term.">?</span></div>
                            </div>                        

                        </div>
                    </div>
                </div>

                <div data-block="costs" class="block">
                    <div class="columns">

                        <div class="column">
                            <div class="field" data-default="2500">
                                <label for="cost_advisor">Financial advisor</label>
                                <div class="control"><input id="cost_advisor" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="cost_advisor_tip" data-tooltip="Costs of getting financial advice.">?</span></div>
                            </div>
                            <div class="field" data-default="3950">
                                <label for="cost_makelaar">Real estate agent</label>
                                <div class="control"><input id="cost_makelaar" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="cost_makelaar_tip" data-tooltip="Cost of ankoopmakelaar services.">?</span></div>
                            </div>
                            <div class="field" data-default="800">
                                <label for="cost_valuation">Valuation</label>
                                <div class="control"><input id="cost_valuation" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="cost_valuation_tip" data-tooltip="Cost of doing house valuation before signing the mortgage deal.">?</span></div>
                            </div>
                            <div class="field" data-default="1200">
                                <label for="cost_notary">Notary</label>
                                <div class="control"><input id="cost_notary" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="cost_notary_tip" data-tooltip="Total notary costs.">?</span></div>
                            </div>
                            <div class="field" data-default="800">
                                <label for="cost_survey">Structural survey</label>
                                <div class="control"><input id="cost_survey" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="cost_survey_tip" data-tooltip="Cost of doing structural house cehck-up.">?</span></div>
                            </div>
                            <div class="field" data-default="450000">
                                <label for="nhg_max_price">NHG price cap</label>
                                <div class="control"><input id="nhg_max_price" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="nhg_max_price_tip" data-tooltip="max. list price of the property allowed to be covered by NHG mortgage scheme (insurance + lower rates).">?</span></div>
                            </div>
                            <div class="field" data-default="0.4">
                                <label for="nhg_cost_pct">NHG fee rate</label>
                                <div class="control"><input id="nhg_cost_pct" class="input" type="text" value="">
                                <span class="icon"><i>%</i></span><span class="tooltip" data-for="nhg_cost_pct_tip" data-tooltip="NHG fee rate (used if mortgagte if NHG eligible).">?</span></div>
                            </div>
                        </div>


                        <div class="column">
                            <div class="field" data-formula="0.02 * house_price">
                                <label for="cost_transfer_tax">Transfer tax</label>
                                <div class="control"><input id="cost_transfer_tax" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="cost_transfer_tax_tip" data-tooltip="Transfer tax (paid if buying used property).">?</span></div>
                            </div>
                            <div class="field" data-formula="0.001 * house_price">
                                <label for="cost_bank">Bank guarantee</label>
                                <div class="control"><input id="cost_bank" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="cost_bank_tip" data-tooltip="Costs of getting bank guarantee for the pre-arrangement stage of the deal.">?</span></div>
                            </div>
                            <div class="field" data-formula="cost_advisor + cost_bank + cost_makelaar + cost_notary + cost_survey + cost_transfer_tax + cost_valuation">
                                <label for="purchase_cost">Purchase costs:</label>
                                <div class="control"><input id="purchase_cost" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="purchase_cost_tip" data-tooltip="Total purchase costs without NHG costs.">?</span></div>
                            </div>
                            <div class="field" data-formula="(house_price + purchase_cost - downpayment) > 0 ? (house_price > nhg_max_price ? 0 : (nhg_cost_pct / 100) * (house_price + purchase_cost - downpayment)):0">
                                <label for="cost_nhg">NHG fee</label>
                                <div class="control"><input id="cost_nhg" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="cost_nhg_tip" data-tooltip="NHG fee, if loan is NHG-eligible.">?</span></div>
                            </div>
                            <div class="field" data-round="0" data-formula="purchase_cost + 1*cost_nhg">
                                <label for="total_purchase_cost">Purchase costs + NHG fee:</label>
                                <div class="control"><input id="total_purchase_cost" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="total_purchase_cost_tip" data-tooltip="Purchase costs with NHG fees included.">?</span></div>
                            </div>
                            <div class="field" data-formula="cost_advisor + cost_notary + cost_survey + cost_valuation + 1*cost_nhg">
                                <label for="purchase_deductible_cost">Tax deductible purchase costs (hypotheekrenteaftrek):</label>
                                <div class="control"><input id="purchase_deductible_cost" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="purchase_deductible_cost_tip" data-tooltip="Portion of purchase costs which is tax deductible: advisor + notary + survey + valuation + nhg costs.">?</span></div>
                            </div>
                        </div>

                    </div>
                </div>

                <div data-block="repayments" class="block">
                    <div class="columns">

                        <div class="column">
                            <div class="field" data-default="10" data-tune="1">
                                <label for="max_extra_payments_per_year_pct">Max extra repayment per year, %</label>
                                <div class="control"><input id="max_extra_payments_per_year_pct" class="input" type="text" value="">
                                <span class="icon"><i>%</i></span><span class="tooltip" data-for="max_extra_payments_per_year_pct_tip" data-tooltip="Max. total annual extra repayment allowed by bank (usually 10%) % from initial principal debt.">?</span></div>
                            </div>
                            <div class="field" data-default="100" data-tune="1">
                                <label for="overpayment_penalty">Penalty for repaying more than allowed</label>
                                <div class="control"><input id="overpayment_penalty" class="input" type="text" value="">
                                <span class="icon"><i>%</i></span><span class="tooltip" data-for="overpayment_penalty_tip" data-tooltip="Penalty percentage of extra repayment in case max. allowed extra repayment threshold is breached. If set to 100 - system will reduce extra-repayments automatically to avoid overpaying and penalties.">?</span></div>
                            </div>
                            <div class="field" data-formula="(max_extra_payments_per_year_pct / 100) * loan">
                                <label for="max_extra_payment_per_year">Max extra repayment per year</label>
                                <div class="control"><input id="max_extra_payment_per_year" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="max_extra_payment_per_year_tip" data-tooltip="Max. annual allowed extra repayment value.">?</span></div>
                            </div>
                            <div class="field" data-round="3" data-formula="(assets_housing - calc_assets_no_repayments(asset_params, loan_params).housing.outcome) / total_paid_extra">
                                <label for="extra_payment_roi">Extra repayment ROI</label>
                                <div class="control"><input id="extra_payment_roi" class="input" type="text" value="">
                                <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="extra_payment_roi_tip" data-tooltip="ROI of extra repayments. Calculated as a difference in the final assets you would have in the end of 'normal' and 'extra repayed' mortagegs over actual total value of extra payments made. 0.2 would mean that every extra euro spent will get you additional 0.2 euro of equity in the end.">?</span></div>
                            </div>
                        </div>

                        <div class="column">
                            <div class="field" data-default="0" data-tune="1">
                                <label for="extra_payment_period">Extra periodic payment, period</label>
                                <div class="control"><input id="extra_payment_period" class="input" type="text" value="">
                                <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="extra_payment_period_tip" data-tooltip="you can set a peridocity of additional repayment here (in months). It could be 12 for once in a year payment (yearly bonus), for example.">?</span></div>
                            </div>
                            <div class="field" data-default="1" data-tune="1">
                                <label for="extra_payment_start">Extra periodic payment, first month:</label>
                                <div class="control"><input id="extra_payment_start" class="input" type="text" value="">
                                <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="extra_payment_start_tip" data-tooltip="month (in the loan lifetime) when the extra payment will happens for the first time.">?</span></div>
                            </div>
                            <div class="field" data-default="0" data-tune="100">
                                <label for="extra_payment_value">Extra periodic payment</label>
                                <div class="control"><input id="extra_payment_value" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="extra_payment_value_tip" data-tooltip="Value of the extra repayment.">?</span></div>
                            </div>
                        </div>

                        <div class="column">
                            <div class="field" data-default="0" data-tune="1">
                                <label for="extra_payment_period1">Extra periodic payment#1, period</label>
                                <div class="control"><input id="extra_payment_period1" class="input" type="text" value="">
                                <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="extra_payment_period1_tip" data-tooltip="Additional periodic repayment periodicity (months). i.e. 12 for annual repayment.">?</span></div>
                            </div>
                            <div class="field" data-default="1" data-tune="1">
                                <label for="extra_payment_start1">Extra periodic payment#1, first month:</label>
                                <div class="control"><input id="extra_payment_start1" class="input" type="text" value="">
                                <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="extra_payment_start1_tip" data-tooltip="Additional periodic repayment: first months when it happens.">?</span></div>
                            </div>
                            <div class="field" data-default="0" data-tune="100">
                                <label for="extra_payment_value1">Extra periodic payment#1</label>
                                <div class="control"><input id="extra_payment_value1" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="extra_payment_value1_tip" data-tooltip="Additional periodit repayment: value of the repayment.">?</span></div>
                            </div>
                        </div>

                        <div class="column">
                            <div class="field" data-default="0" data-tune="1">
                                <label for="extra_payment_period2">Extra periodic payment#2, period</label>
                                <div class="control"><input id="extra_payment_period2" class="input" type="text" value="">
                                <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="extra_payment_period2_tip" data-tooltip="Additional periodic repayment periodicity (months). i.e. 12 for annual repayment.">?</span></div>
                            </div>
                            <div class="field" data-default="1" data-tune="1">
                                <label for="extra_payment_start2">Extra periodic payment#2, first month:</label>
                                <div class="control"><input id="extra_payment_start2" class="input" type="text" value="">
                                <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="extra_payment_start2_tip" data-tooltip="Additional periodic repayment: first months when it happens.">?</span></div>
                            </div>
                            <div class="field" data-default="0" data-tune="100">
                                <label for="extra_payment_value2">Extra periodic payment#2</label>
                                <div class="control"><input id="extra_payment_value2" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="extra_payment_value2_tip" data-tooltip="Additional periodit repayment: value of the repayment.">?</span></div>
                            </div>
                        </div>

                    </div>
                </div>

                <div data-block="assets" class="block">
                    <div class="columns">
                        <div class="column">
                            <div class="field" data-default="0.0" data-tune="0.2">
                                <label for="deposit_rate">Deposit rate</label>
                                <div class="control"><input id="deposit_rate" class="input" type="text" value="">
                                <span class="icon"><i>%</i></span><span class="tooltip" data-for="deposit_rate_tip" data-tooltip="Interest paid on the deposits (annual). Used in profitability calculations.">?</span></div>
                            </div>
                            <div class="field" data-default="0.0" data-tune="0.2">
                                <label for="house_market_rate">House appreciation rate</label>
                                <div class="control"><input id="house_market_rate" class="input" type="text" value="">
                                <span class="icon"><i>%</i></span><span class="tooltip" data-for="house_market_rate_tip" data-tooltip="Annual housing market growth, expected annual sell-price change. Used in profitability calculations.">?</span></div>
                            </div>
                            <div class="field" data-default="0.0" data-tune="1.0">
                                <label for="stocks_rate">Stocks growth rate</label>
                                <div class="control"><input id="stocks_rate" class="input" type="text" value="">
                                <span class="icon"><i>%</i></span><span class="tooltip" data-for="stocks_rate_tip" data-tooltip="Annual stocks growth rate. Used in profitability calculations.">?</span></div>
                            </div>
                            
                            <div class="field" data-default="1" data-tune="1">
                                <label for="bonus_month">Annual bonus, accrual month</label>
                                <div class="control"><input id="bonus_month" class="input" type="text" value="">
                                <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="bonus_month_tip" data-tooltip="Month (in the lifetime of the mortgage) when annual bonus is paid.">?</span></div>
                            </div>
                            <div class="field" data-default="0" data-tune="1000">
                                <label for="bonus_cash">Annual cash bonus, amount</label>
                                <div class="control"><input id="bonus_cash" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="bonus_cash_tip" data-tooltip="Annual bonus cash portion. Used in profitability calculations.">?</span></div>
                            </div>
                            <div class="field" data-default="0" data-tune="1000">
                                <label for="bonus_stocks">Annual stocks bonus, amount</label>
                                <div class="control"><input id="bonus_stocks" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="bonus_stocks_tip" data-tooltip="Annual bonus sticks portion. Used in profitability calculations.">?</span></div>
                            </div>
                        </div>

                        <div class="column">
                            <div class="field" data-default="0" data-tune="1000">
                                <label for="total_stocks_savings">Available stocks value</label>
                                <div class="control"><input id="total_stocks_savings" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="total_stocks_savings_tip" data-tooltip="Initial assets: stocks value.">?</span></div>
                            </div>
                            <div class="field" data-formula="total_stocks_savings + total_cash_savings">
                                <label for="total_savings">Total available savings</label>
                                <div class="control"><input id="total_savings" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="total_savings_tip" data-tooltip="Total assets available before opening the mortgage.">?</span></div>
                            </div>

                            <div class="field" data-formula="Math.round(1000 * downpayment / total_savings)/10">
                                <label for="downpayment_to_savings">Fraction of assets used for downpayment</label>
                                <div class="control"><input id="downpayment_to_savings" class="input" type="text" value="">
                                <span class="icon"><i>%</i></span><span class="tooltip" data-for="downpayment_to_savings_tip" data-tooltip="Fraction of total assets being used to open the mortgage.">?</span></div>
                            </div>
                            <div class="field" data-formula="total_savings - downpayment">
                                <label for="savings_left">Assets left after downpayment</label>
                                <div class="control"><input id="savings_left" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="savings_left_tip" data-tooltip="Total liquid assets left right after opening the mortgage. This should not be less than triple of your monthly expenses.">?</span></div>
                            </div>

                            <div class="field" data-formula="(monthly_savings + monthly_payment_rent) * ([0, 185, 147, 273][loan_type])">
                                <label for="max_loan">Approx. maximum loan</label>
                                <div class="control"><input id="max_loan" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="max_loan_tip" data-tooltip="A very rough estimation of maximal amount you can count on getting with your monthly budget (depends on the loan type).">?</span></div>
                            </div>
                            <div class="field" data-formula="max_loan + total_savings">
                                <label for="max_value">Approx. maximum house value</label>
                                <div class="control"><input id="max_value" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="max_value_tip" data-tooltip="A very rough estimation of the max. budget you might have to by a property.">?</span></div>
                            </div>

                        </div>


                        <div class="column">
                            <div class="field" data-formula="monthly_payment_rent * loan_term_actual">
                                <label for="total_rent_actual">Total rent paid (would be, during actual term)</label>
                                <div class="control"><input id="total_rent_actual" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="total_rent_actual_tip" data-tooltip="Total rent would be paid during the actual mortgage term if you would continue renting instead of buying.">?</span></div>
                            </div>
                            <div class="field" data-formula="monthly_payment_rent * loan_term">
                                <label for="total_rent">Total rent paid (would be, during total term)</label>
                                <div class="control"><input id="total_rent" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="total_rent_tip" data-tooltip="Total rent would be paid during the mortgage term if you would continue renting instead of buying.">?</span></div>
                            </div>
                            <div class="field" data-formula="assets_result.renting.outcome">
                                <label for="assets_renting">Final assets: renting</label>
                                <div class="control"><input id="assets_renting" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="assets_renting_tip" data-tooltip="Final expected equity accumulated during the mortgage term with all incomes expenses, markets growth rates taken into account. For the 'keep renting' scenario.">?</span></div>
                            </div>

                            <div class="field" data-formula="assets_result.months_to_even">
                                <label for="months_to_even">Months to even buy vs rent</label>
                                <div class="control"><input id="months_to_even" class="input" type="text" value="">
                                <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="months_to_even_tip" data-tooltip="How many months into the mortgage until equities accumulated for 'buy' and 'rent' scenarios become equal. After that month 'buy' scenario becomes profitable compared to 'rent'.">?</span></div>
                            </div>

                            <div class="field" data-formula="assets_result.warnings_housing[0]">
                                <label for="months_with_negative_increment">Months with negative monthly cash increment</label>
                                <div class="control"><input id="months_with_negative_increment" class="input" type="text" value="">
                                <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="months_with_negative_increment_tip" data-tooltip="Expected number of months where total monthly costs will be higher than monthly income.">?</span></div>
                            </div>

                            <div class="field" data-formula="assets_result.warnings_housing[1]">
                                <label for="months_with_negative_balance">Months with negative cash balance</label>
                                <div class="control"><input id="months_with_negative_balance" class="input" type="text" value="">
                                <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="months_with_negative_balance_tip" data-tooltip="Expected number of months where total cash balance will be negative (debt default condition).">?</span></div>
                            </div>

                        </div>


                        <div class="column">
                            <div class="field" data-round="4" data-default="0.35" data-tune="0.05">
                                <label for="ownership_pct">House ownership tax percentage (eigenwoningforfait)</label>
                                <div class="control"><input id="ownership_pct" class="input" type="text" value="">
                                <span class="icon"><i>%</i></span><span class="tooltip" data-for="ownership_pct_tip" data-tooltip="House ownership tax rate.">?</span></div>
                            </div>
                            <div class="field" data-formula="house_value * ownership_pct * (1/(100*12)) * tax_rate * (1/100)">
                                <label for="monthly_ownership_tax">monthly house ownership tax (eigenwoningforfait)</label>
                                <div class="control"><input id="monthly_ownership_tax" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="monthly_ownership_tax_tip" data-tooltip="Monthly value of the house ownership tax to be paid.">?</span></div>
                            </div>
                            <div class="field" data-formula="assets_result.housing.outcome">
                                <label for="assets_housing">Final assets: housing</label>
                                <div class="control"><input id="assets_housing" class="input" type="text" value="">
                                <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="assets_housing_tip" data-tooltip="Final expected equity accumulated during the mortgage term with all incomes expenses, house value, markets growth rates taken into account. For the 'buy' scenario.">?</span></div>
                            </div>

                            <div class="field" data-round="0" data-formula="assets_housing - assets_renting">
                                <label for="assets_delta">Housing - Renting</label>
                                <div class="control"><input id="assets_delta" class="input" type="text" value="">
                                <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="assets_delta_tip" data-tooltip="Difference in final equity accumulated by the end of the mortgage term for 'rent' and 'buy' scenarios.">?</span></div>
                            </div>
                            <div class="field" data-round="3" data-formula="assets_housing / assets_renting">
                                <label for="assets_k">Housing / Renting</label>
                                <div class="control"><input id="assets_k" class="input" type="text" value="">
                                <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="assets_k_tip" data-tooltip="Ratio of final equities estimated for 'rent' and 'buy' scenarios.">?</span></div>
                            </div>

                            <div class="field" data-round="3" data-formula="(30*12) * (assets_housing - assets_renting) / (loan_term * Math.max(0, total_paid_interest - total_tax_returned))">
                                <label for="housing_roi">Housing ROI</label>
                                <div class="control"><input id="housing_roi" class="input" type="text" value="">
                                <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="housing_roi_tip" data-tooltip="ROI of the mortgage. Difference in final equities for 'rent' and 'buy' scenarios over net interest paid (normalized for standard mortgage term - 30 years).">?</span></div>
                            </div>

                        </div>

                    </div>
                </div>

                <div data-block="whatif" class="block">
                    <p data-id="p-0">Here you can "test" what would happen if some parameters of the mortgage would differ.<br>‚Ä¢ <b>"Variable1"</b> and <b>"Variable2"</b> fields describe the range of variability for the parameters to be tested.<br>Range description format: <b>variable_name(start_value, end_value, steps)</b>¬†</p>
                    <p data-id="p-1">‚Ä¢ <b>"Metrics"</b> comma-separated list of variables or expressions (using variables) you would like to measure for each "tested" loan. In a simpliest case - it is just a parameter name of interest (e.g. <b>loan_term_actual</b>)<br>Outcomes of the modelling drawn on the <b>[What-if Graph]</b> section below.¬†</p>
                    <hr>
                    <p data-id="p-2">‚Ä¢ If you "test" one parameter - you will get a 2D plot of Metrics required. IF you "test" two parameters - you will get a <b>3D</b> plot(surface) of the first metric (or expression) in the list.¬†</p>
                    <p data-id="p-3">‚Ä¢ You can use "original" mortgage parameter value in expressions using <b>_0</b> postfix (e.g. <b>loan_term_actual_0</b>).¬†</p>
                    <p data-id="p-4">‚Ä¢ Probing takes time (depends on the number of steps requested), probing process starts by <b>[Recalculate]</b> button.<br>¬†</p>
                    <hr>

                    <div class="columns">
                        <div class="column">
                            <div class="field" data-type="raw" data-default="extra_payment_topup(100,3000,10)">
                                <label for="variable1">Variable#1</label>
                                <div class="control"><input id="variable1"  class="input" type="text" value="">
                                <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="variable1_tip" data-tooltip="First variable to 'test' and tested values range.">?</span></div>
                            </div>
                            <div class="field" data-type="raw" data-default="">
                                <label for="variable2">Variable#2</label>
                                <div class="control"><input id="variable2" class="input" type="text" value="">
                                <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="variable2_tip" data-tooltip="Second variable to 'test' and tested values range. May be empty. If not empty - only one (first) metric will be estimated and plotted on the 3D surface plot.">?</span></div>
                            </div>

                            <div class="field" data-type="raw" data-default="assets_k,assets_delta,total_interest_percentage,total_loan_invested,monthly_avg_loan_invested,loan_term_actual,housing_roi,extra_payment_roi">
                                <label for="metrics">Metrics</label>
                                <div class="control"><input id="metrics" class="input" type="text" value="">
                                <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="metrics_tip" data-tooltip="List (comma separated) of metrics/parameters of the mortgage to plot for 'tested' variables. If both first and second variable are set - only the first metric will be taken. 'Metric' here could also be an expression, for exapmle (assets_delta / assets_delta_0)">?</span></div>
                            </div>
                            <button class="recalc_button" onclick="recalculate_fields()">Recalculate</button>
                        </div>
                    </div>
                </div>

                <div data-block="entry" class="block">
                    <p data-id="p-5">Here you can model different "entry" months for opening the loan.<br>‚Ä¢ Up to 30*12 months ahead will be tested and predefined set of metrics will be extracted from these "tested" mortgages (from specific month of their lifetime).<br>‚Ä¢ Modelling will stop at the moment when no mortgage will be needed to buy the house (if that moment ever comes).<br>¬†</p>
                    <p data-id="p-6">Hypothetic mortgages will have different "entry" parameters:<br>‚Ä¢ assets increase will be calculated according to your cash accumulation settings / bonuses etc..<br>‚Ä¢ savings used for the loan downpayment will be scaled proportionally to your assets.<br>‚Ä¢ house price will be scaled according to the house market growth rate.<br>¬†</p>
                    <p data-id="p-7">Outcomes of the modelling will appear on the <b>[Entrypoint Graphs]</b> section below.¬†</p>
                    <hr>
                    <p data-id="p-8">‚Ä¢ Loan entry parameters will be plotted with <b>entry_</b> prefix.<br>‚Ä¢ Loan final parameters will be plotted with <b>loan_</b> prefix.<br>‚Ä¢ Loan intermediate metrics will be plotted with <b>@</b> postfix.¬†</p>
                    <hr>
                    <div class="columns">
                        <div class="column">
                            <div class="field" data-default="20*12" data-tune="1">
                                <label for="entry_probe_month">Month to take loan metrics @:</label>
                                <div class="control"><input id="entry_probe_month" class="input" type="text" value="">
                                <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="entry_probe_month_tip" data-tooltip="'Probe' month. Many hypothetical mortgages will be modelled for different 'start' months. For each mortgage a predefined set of metrics will be extracted. To be comparable - these metrics will be extracted from a specific month. This field defines that month.">?</span></div>
                            </div>
                            <button class="recalc_button" onclick="recalculate_fields()">Recalculate</button>
                        </div>
                    </div>
                </div>
           
            </section>
        </div>

        <div data-block="llm" class="block">
            <section class="section"><h2 data-id="h_7">LLM-based mortgage calculation and analysis assistant:</h2>
                <div class="columns">
                    <div class="column">
                        <hr>
                            <div id="chat_log">

                                This is an <b>experimental</b> locally-integrated LLM ChatBot, it works in your browser directly.<br>
                                <br>
                                <b>Upsides:</b> <br>
                                &bull; it is free and can work without internet (after first being downloaded and cached in your browser).<br>
                                &bull; because it works directly in your browser - no conversational information is being sent over Internet to anywhere (any other servers).<br>
                                <br>
                                <b>Downsides:</b> <br>
                                &bull; To work it needs quite a lot of RAM and CPU resources - answer generation <b>will take noticeable time.</b><br>
                                &bull; It will probably NOT work in mobile environments (because of RAM constraints).<br>
                                &bull; Model being used in a small, quantized version of Phi-3.1-mini, it is quite capable for it's size but it is not as capable as bigger models.<br>
                                &bull; Model used was trained in English, it can respond in other languages but it works best in English. Therefore the Bot works best with English version of the calculator.<br>

                                <br>
                                <hr>
                                <strong>Bot will inevitably hallucinate and at some point will provide inaccurate or false information.</strong><br>
                                <strong>&bull; Do not take seriously what it generates, ever. Always doublecheck facts, statements and conclusions.</strong><br>
                                <strong>&bull; Do not make any important decisions based only on a LLM-generated content.</strong> 
                                <hr>

                                <br>
                                <b>Purpose and functionality:</b> <br>
                                The Bot is integrated with mortgage calculation functionality on this web site - if needed it will access and change current mortgage calculation parameters.<br>
                                Its primary task is to help to fill mortgage calculation parameters into the calculation tool.<br>
                                If you describe your situation in a message - it will extract relevant information from the message, update relevant parameters in calculator, run calculation and then provide explanation and analysis of the outcomes.<br>
                                <br>
                                ***
                                <br>
                                Additionally the Bot can: <br>
                                &bull; answer questions about this mortgage calculator: paramers available, their meaning..<br>
                                &bull; perform analysis and generate review of the current mortgage calculation.<br>
                                &bull; answer generic mortgage-related questions (e.g: "What 'mortgage term'" parameter means).<br>
                                &bull; respond to generic / non mortgage-related queries.<br>
                                <br>
                                LLM functionality should work in latest Chrome browsers, ad blockers or spam filtering extensions may interfere with it (it can then get stuck in "Loading" status).<br>
                            </div>
                        <button class="recalc_button" id="chat_start">Start</button>
                        <textarea id="chat_input" placeholder="Your message..." style="display:none"></textarea>
                        <button class="recalc_button" id="chat_stop">Interrupt response generation</button>
                        <iframe id="chat_llm" allow="cross-origin-isolated" style="display:none"></iframe>
                        <hr>
                    </div>
                </div>
            </section>
        </div>

        <div data-block="help" class="block">
            <section class="section"><h2 data-id="h_7">Help</h2>
                <div class="columns">
                    <div class="column">
                        <hr><b data-id="hlp-01">Input values</b><hr>
                        <p data-id="hlp-1">Input fields allow entering simple formulas using arithmetical espressions.<br>Example of a valid input: <b>(1+2*3)/4</b><br>Most of the input values can be "tuned": hover mouse over and scroll up/down with Shift pressed<br>When pointed with a mouse - tooltip for the input values will display the field's variable name (used in other formulas).¬†</p><br>
    
                        <hr><b data-id="hlp-02">Output values</b><hr>
                        <p data-id="hlp-2">Output values calculated automatically from input values (calculated fields are disabled for manual input)<br>When pointed with a mouse - tooltip for the field will show the field's variable name and calculation formula.¬†</p><br>
    
                        <hr><b data-id="hlp-03">Payments Schedule</b><hr>
                        <p data-id="hlp-3">Monthly mortgage plan<br><b>total_payment</b> = base_payment + extra_payment + extra_payment2 + penalty<br><b>base_payment</b> = capital_payment + interest_amt (capital payment and interest amount values depend on the mortgage type)<br><b>extra_payment</b> - additional montlhy repayments, topped up so that total_payment not less than extra_payment_topup<br><b>extra_payment2</b> - additional periodic repayments.¬†</p><br>
    
                        <hr><b data-id="hlp-04">Manual adjustments to payments Schedule</b><hr>
                        <p data-id="hlp-4"><b>extra_payment</b> values can be manually adjusted by clicking on the value in the payment schedule cell. Adjusted values "live" until any other parameters of the loan gets changed and loan gets recalculated.¬†</p><br>
    
                        <hr><b data-id="hlp-05">Extra repayments</b><hr>
                        <p data-id="hlp-5">There are several repayments that can be modelled:<br>‚Ä¢ <b>Monthly repayment</b>: fixed monthly extra repayment used for every month of the mortgage.<br>‚Ä¢ <b>Flexible periodic repayment</b>: more flexible - period, value and starting month of the repayment can be chosen.<br>‚Ä¢ there is also 2 additional flexible repayments can be set on <b>[Extra repayments]</b> tab<br>‚Ä¢ <b>extra_payment_topup</b>: every month an extra repayment will be "made" automatically such that total monthly payment is <b>not less</b> than this value.<br>¬†</p><br>
    
                        <hr><b data-id="hlp-06">Extra repayment penalties</b><hr>
                        <p data-id="hlp-6">Banks usually do not like early repayments and set a limit on how much you can repay (yearly) - everything you repay on top of the limit will be penalized.<br>‚Ä¢ <b>Max extra repayment per year, %</b> - sets that threshold (% from the original principal debt).<br>‚Ä¢ <b>Penalty for repaying more than allowed</b> - sets the value of the penalty  - % from the payment value. If this parameter set to 100 - payments will be automatically adjusted to never exceed the allowed threshold.<br>¬†</p><br>
    
                        <hr><b data-id="hlp-07">Profitability analysis</b><hr>
                        <p data-id="hlp-7">Using parameters from the corresponding tab you can set values of your income, bonuses expenses etc. These then will be used to calculate different mortgage effeciency metrics.<br>Resulting metrics will be immediately shown in the calculatable fields, also some other metrics and their dynamics during the mortgage lifetime will be plotted on the corresponding graphs section below.¬†</p><br>
    
                        <hr><b>Interest rates</b><hr>
                        <p>
                            &bull; <a style="color:red" href="https://www.hypotheekrente.nl/rente/10-jaar-rentevast/60/#overzicht">Overview</a><br>
                            &bull; <a style="color:red" href="https://www.abnamro.nl/en/personal/mortgages/interest-rates/index.html">ABN Amro</a><br>
                            &bull; <a style="color:red" href="https://www.ing.nl/particulier/hypotheek/actuele-hypotheekrente">ING</a><br>
                            &bull; <a style="color:red" href="https://www.rabobank.nl/particulieren/hypotheek/hypotheekrente">Rabo Bank</a><br>
                        </p><br>
    
                        <hr><b>Supporting links</b><hr>
                        <p>
                            &bull; <a style="color:red" href="https://www.rijksoverheid.nl/onderwerpen/huis-kopen/vraag-en-antwoord/checklist-woning-kopen">Rijksoverheid : checklist-woning-kopen (NL)</a><br>
                            &bull; <a style="color:red" href="https://www.rijksoverheid.nl/onderwerpen/huis-kopen/vraag-en-antwoord/hypotheek-aanvragen-wat-moet-ik-regelen">Rijksoverheid : hypotheek aanvragen (NL)</a><br>
                            &bull; <a style="color:red" href="https://www.rijksoverheid.nl/onderwerpen/huis-kopen/documenten/brochures/2017/11/30/brochure-voordat-u-een-appartement-koopt-2017">Rijksoverheid : Voordat u een appartament koopt</a><br>
                            &bull; <a style="color:red" href="https://www.wijzeringeldzaken.nl/rekenhulpen/rekenhulp-maximale-hypotheek-op-basis-van-maandlasten/">Wijzer: maximale hypotheek op basis van je maandlasten (NL)</a><br>
                        </p>
    
                        <hr>
                    </div>
                </div>
            </section>
        </div>

        <section class="section"><h2 class="subtitle" data-id="h_4">Modelling results:</h2>
            <div class="tabs is-primary">
                <ul>
                    <li class="tab_selector is-active" data-block="graph_payments"><a role=button rel="nofollow" data-id="b_g_payments">üìà Payments Graph</a></li>
                    <li class="tab_selector" data-block="schedule"><a role=button rel="nofollow" data-id="b_schedule">ùÑú Payments Schedule</a></li>
                    <li class="tab_selector" data-block="graph_assets"><a role=button rel="nofollow" data-id="b_g_assets">üìà Profitability Graphs</a></li>
                    <li class="tab_selector" data-block="graph_whatif"><a role=button rel="nofollow" data-id="b_g_whatif">üìà What-if Graph</a></li>
                    <li class="tab_selector" data-block="graph_entry"><a role=button rel="nofollow" data-id="b_g_entry">üìà Entrypoint Graphs</a></li>
                </ul>
            </div>

            <div data-block="schedule-hidden" class="block">
                <div class="columns">
                    <div class="column">
                        <div class="field" id="loan_params" data-formula="gather_param_values(['loan_type', 'loan_term', 'interest_rate', 'tax_rate', 'loan','monthly_ownership_tax', 'purchase_deductible_cost', 'tax_scheme','extra_payment_monthly', 'extra_payment_period', 'extra_payment_start','extra_payment_value', 'extra_payment_period1', 'extra_payment_start1','extra_payment_value1', 'extra_payment_period2', 'extra_payment_start2', 'extra_payment_value2', 'max_extra_payment_per_year', 'overpayment_penalty', 'extra_payment_topup'],'').calculation_context">
                            <label>Hidden cell to collect loan parameters structure</label>
                            <div class="control"></div>
                        </div>

                        <div class="field" id="asset_params" data-formula="gather_param_values(['total_cash_savings', 'total_stocks_savings', 'deposit_rate', 'stocks_rate', 'monthly_savings', 'loan_result', 'loan_term', 'downpayment', 'bonus_month', 'bonus_cash', 'bonus_stocks', 'monthly_payment_rent', 'monthly_ownership_tax', 'loan', 'house_value', 'house_market_rate'],'').calculation_context">
                            <label>Hidden cell to collect asset calculation parameters</label>
                            <div class="control"></div>
                        </div>

                        <div class="field" id="assets_result" data-formula="calc_assets(asset_params)">
                            <label>Hidden cell to hold montlhy asset calculations</label>
                            <div class="control"></div>
                        </div>

                        <div class="field" id="loan_result" data-formula="calculate_loan(loan_params)">
                            <label>Hidden cell to collect loan schedule and stats</label>
                            <div class="control"></div>
                        </div>

                        <div class="field" id="loan_stats_result" data-formula="loan_stats(loan_result)">
                            <label>Hidden cell to collect loan schedule stats</label>
                            <div class="control"></div>
                        </div>

                        <div class="field" id="schedule" data-formula="loan_schedule(loan_result)">
                            <label>Hidden cell to update loan payments schedule</label>
                            <div class="control"><input class="input" type="text" value=""></div>
                        </div>

                        <div class="field" id="graph_p" data-formula="graph_payments(loan_result)">
                            <label>Hidden cell to update loan payments graph</label>
                            <div class="control"><input class="input" type="text" value=""></div>
                        </div>

                        <div class="field" id="graph_a" data-formula="graph_assets(assets_result)">
                            <label>Hidden cell to update loan payments graph</label>
                            <div class="control"><input class="input" type="text" value=""></div>
                        </div>

                    </div>
                </div>
            </div>

            <div data-block="schedule" class="block" style="height: 480px; overflow: auto;background-color:#FFF;">
                <div class="columns">
                    <div class="column">
                    </div>  
                </div>
            </div>

            <div data-block="graph_payments" class="block">
                <div class="columns">
                    <div class="column">
                        <div id="graph_payments_target"></div>
                    </div>  
                </div>
            </div>

            <div data-block="graph_assets" class="block">
                <div class="columns">
                    <div class="column">
                        <div id="graph_assets_target"></div>
                    </div>  
                </div>
            </div>

            <div data-block="graph_whatif" class="block">
                <div class="columns">
                    <div class="column">
                        <div id="graph_whatif_target">This graph updated when you run "Recalculate" from "What-if" section above.</div>
                    </div>  
                </div>
            </div>

            <div data-block="graph_entry" class="block">
                <div class="columns">
                    <div class="column">
                        <div id="graph_entry_target">This graph updated when you run "Recalculate" from "Entrypoint" section above.</div>
                    </div>  
                </div>
            </div>

        </section>

        <section class="section"><h2 data-id="h_6">Key figures:</h2>
            <div class="columns">
                <div class="column">
                    <div class="field" data-formula="loan">
                        <label for="t_loan">Required loan amount</label>
                        <div class="control"><input id="t_loan" class="input" type="text" value="">
                        <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="t_loan_tip" data-tooltip="Loan value required">?</span></div>
                    </div>
                    <div class="field" data-formula="loan_term_actual">
                        <label for="t_loan_term_actual">Loan term, actual (months)</label>
                        <div class="control"><input id="t_loan_term_actual" class="input" type="text" value="">
                        <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="t_loan_term_actual_tip" data-tooltip="Actual mortgage lifetime, can be shorter than loan term if repayments are made.">?</span></div>
                    </div>
                    <div class="field" data-formula="total_loan_invested">
                        <label for="t_total_loan_invested">Total loan invested</label>
                        <div class="control"><input id="t_total_loan_invested" class="input" type="text" value="">
                        <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="t_total_loan_invested_tip" data-tooltip="Total amount spend on mortgage.">?</span></div>
                    </div>
                </div>

                <div class="column">
                    <div class="field" data-formula="loan_stats_result.payment_first">
                        <label for="monthly_payment_loan">Monthly mortgage payment</label>
                        <div class="control"><input id="monthly_payment_loan" class="input" type="text" value="">
                        <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="monthly_payment_loan_tip" data-tooltip="Calculated normal monthly mortgage payment">?</span></div>
                    </div>
                    <div class="field" data-formula="loan_stats_result.payment_base_first">
                        <label for="payment_base_first">First base payment (principal + interest)</label>
                        <div class="control"><input id="payment_base_first" class="input" type="text" value="">
                        <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="payment_base_first_tip" data-tooltip="First scheduled payment base value, i.e. only (interest + debt) parts of the payment.">?</span></div>
                    </div>
                    <div class="field" data-formula="monthly_payment_loan - monthly_payment_rent">
                        <label for="monthly_payment_difference">Difference between 'buy' and 'rent' monthly payments</label>
                        <div class="control"><input id="monthly_payment_difference" class="input" type="text" value="">
                        <span class="icon"><i>‚Ç¨</i></span><span class="tooltip" data-for="monthly_payment_difference_tip" data-tooltip="Difference between monthly mortgage payment ('buy' scenario) and monthly rent payment ('rent' scenario), if negative - monthly payment for 'buy' scenario is lower than monthly 'rent' payment.">?</span></div>
                    </div>
                </div>

                <div class="column">
                    <div class="field" data-round="0" data-formula="assets_delta">
                        <label for="t_assets_delta">Housing - Renting</label>
                        <div class="control"><input id="t_assets_delta" class="input" type="text" value="">
                        <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="t_assets_delta_tip" data-tooltip="Difference in final equity for 'buy a house' and 'keep renting' scenarios.">?</span></div>
                    </div>
                    <div class="field" data-round="3" data-formula="housing_roi">
                        <label for="t_housing_roi">Housing ROI</label>
                        <div class="control"><input id="t_housing_roi" class="input" type="text" value="">
                        <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="t_housing_roi_tip" data-tooltip="ROI of getting the mortgage. See more on [profitability] page.">?</span></div>
                    </div>

                    <div class="field"  data-round="3" data-formula="extra_payment_roi">
                        <label for="t_extra_payment_roi">Extra repayment ROI</label>
                        <div class="control"><input id="t_extra_payment_roi" class="input" type="text" value="">
                        <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="t_extra_payment_roi_tip" data-tooltip="ROI of extra payments made. See more on [extra repayments] page.">?</span></div>
                    </div>
                </div>
            </div>

            <div class="field" data-type="raw" data-formula="monthly_payment_diagnose(monthly_payment_loan, monthly_payment_rent, monthly_savings, months_with_negative_increment, months_with_negative_balance)">
                <label for="monthly_payment_comparison">Outcome of comparison of monthly payments in 'buy' and 'rent' scenarios</label>
                <div class="control"><input id="monthly_payment_comparison" class="input" type="text" value="">
                <span class="icon"><i>&gt;</i></span><span class="tooltip" data-for="monthly_payment_comparison_tip" data-tooltip="">?</span></div>
            </div>
        </section>

        <div class="section">
            <div class="columns">

                <div class="column"><hr>
                    <div class="disclaimer section">
                        <b>Information:</b>
                        <p>This is an independent open-source mortgage analitics tool.</p>
                        <p>All calculations made securely, only inside your own browser.</p>
                        <p><b>The website uses cookies for usage statistics.</b></p>
                    </div>
                </div>

                <div class="column"><hr>
                    <b>Source:</b><br>
                    <br>
                    <a href="https://github.com/r0d1on/mortgage-tool" class="github-link" target="_blank" rel="noopener noreferrer">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBkPSJNOS45OTkgMGMtNS41MjEgMC05Ljk5OSA0LjU5LTkuOTk5IDEwLjI1MyAwIDQuNTMgMi44NjUgOC4zNzMgNi44MzkgOS43MjguNS4wOTQuNjgzLS4yMjIuNjgzLS40OTRsLS4wMTQtMS43NDRjLTIuNzgyLjYxOS0zLjM2OC0xLjM3NS0zLjM2OC0xLjM3NS0uNDU1LTEuMTg1LTEuMTExLTEuNS0xLjExMS0xLjUtLjkwOC0uNjM2LjA2OS0uNjIzLjA2OS0uNjIzIDEuMDA0LjA3MiAxLjUzMiAxLjA1NyAxLjUzMiAxLjA1Ny44OTIgMS41NjcgMi4zNDEgMS4xMTQgMi45MS44NTIuMDkxLS42NjIuMzQ5LTEuMTE0LjYzNS0xLjM3LTIuMjItLjI1OS00LjU1NS0xLjEzOS00LjU1NS01LjA2OCAwLTEuMTE5LjM5LTIuMDM1IDEuMDI5LTIuNzUxLS4xMDMtLjI1OS0uNDQ2LTEuMzAyLjA5OC0yLjcxMyAwIDAgLjgzOS0uMjc2IDIuNzUgMS4wNTEuNzk3LS4yMjggMS42NTMtLjM0MSAyLjUwMy0uMzQ2Ljg1LjAwNCAxLjcwNS4xMTggMi41MDMuMzQ2IDEuOTA5LTEuMzI3IDIuNzQ3LTEuMDUxIDIuNzQ3LTEuMDUxLjU0NiAxLjQxMS4yMDMgMi40NTQuMSAyLjcxMy42NDEuNzE2IDEuMDI4IDEuNjMyIDEuMDI4IDIuNzUxIDAgMy45MzktMi4zMzggNC44MDYtNC41NjYgNS4wNTkuMzU5LjMxNy42NzguOTQyLjY3OCAxLjg5OCAwIDEuMzcxLS4wMTIgMi40NzctLjAxMiAyLjgxMyAwIC4yNzQuMTguNTk0LjY4OC40OTMgMy45NzEtMS4zNTkgNi44MzMtNS4xOTkgNi44MzMtOS43MjggMC01LjY2My00LjQ3OC0xMC4yNTMtMTAuMDAxLTEwLjI1MyIgZmlsbD0iIzAwMCIvPgo8L3N2Zz4K" alt="github" class="github-inner">
                        Github
                    </a>
                    <br>
                    <br>
                    <span id="version"><small style="color:black">version</small></span>
                </div>

                <div class="column"><hr>
                    <div class="disclaimer section">

                        <b>Donate:</b>
                        <p>If the tool helped you in decision making or saved you some time or money - please consider supporting the development.</p>
                        <p>Just like with mortgage repayments - every cent matters :) </p>
                        <ul style="padding-left: 0px;">
                            <li>
                                <img width="32" height="32" alt="buy me a coffee icon" src="../images/buy_me_a_coffee.svg"> <a style="position:relative;top:-7px;" href="https://buymeacoffee.com/r0d1on">buymeacoffee.com/r0d1on</a>
                            </li>
                            <li>
                                <img width="32" height="32" alt="patreon icon" src="../images/patreon.svg"> <a style="position:relative;top:-14px;" href="https://patreon.com/r0d1on/shop">patreon.com/r0d1on</a>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="column"><hr>
                    <div class="disclaimer section">
                        <b>Disclaimer:</b>
                        <p>The tool intended only for research purposes - use it at your own risk.</p>
                        <p>There is no guarantee for the quality and accuracy of the data provided.</p>
                        <p><b>Involve a qualified professional before making any decisions.</b></p>
                    </div>
                </div>

            </div>
        </div>

    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function(event){
            const gh_pages_host = "r0d1on.github.io"; //"127.0.0.1:5000";
            let show_ribbon = (window.location.href).split(/\/\//)[1].split(/\//)[0]==gh_pages_host;
            //document.body.style['overflow'] = 'hidden';
            if (show_ribbon) {
                let c = document.createElement("div");
                c.style["position"] = "absolute";
                c.style["right"] = "0px";
                c.style["top"] = "0px";
                c.style['overflow'] = 'hidden';
                document.body.appendChild(c);

                let a = document.createElement("a");
                a.innerHTML = '<img width="149" height="149" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_green_007200.png?resize=149%2C149" class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1">';
                a.href = "https://github.com/r0d1on/mortgage-tool";
                a.style["position"] = "relative";
                a.style["right"] = "0px";
                a.style["top"] = "0px";
                c.appendChild(a);
                
                let f = (a, c)=>{
                    return ()=>{
                        if (c>=0) {
                            a.style["right"] = (-c)+"px";
                            a.style["top"] = (-c)+"px";
                        };
                        if (c < 150)
                            setTimeout(f(a, c+1), 10);
                    };
                };
                
                f(a, -150)();
            };

            let version = document.getElementById("version");
            version.innerHTML = `<small style="color:black">version: ${deploy_info.version}<br>last updated: ${deploy_info.time}</small>`;
        });
    </script>

    <div id="progress_overlay"><div id="progress_bar"></div></div>

</body>

</html>